subprojects {
    apply plugin: 'java'
    apply plugin: 'eclipse'
    apply plugin: 'idea'

    repositories {
        mavenCentral()
    }

    dependencies {
        testCompile group: 'junit', name: 'junit', version: '4.11'
    }
}

configure(subprojects.findAll {it.name =~ /plugin/ || it.name =~ /^freeplane$/ || it.name =~ /^freeplane_framework$/}){
    repositories {
        maven {
            url 'http://www.knopflerfish.org/maven2/'
        }
    }

    dependencies {
        compile group: 'org.knopflerfish', name:'frameworkbundle', version: '4.1.10'
    }
}

configure(subprojects.findAll {it.name =~ /plugin/ || it.name =~ /^freeplane$/}) {
    apply plugin: 'osgi'

    // copy the plugin jars to <toplevel>/DIST:
    task copy_plugin_jars(type: Copy) {
         from ('build/libs') {
              include("*.jar")
         }
         if (project.name.equals("freeplane")) {
           into('../DIST/core')
         } else {
           into('../DIST/plugins')
         }
    }

    copy_plugin_jars.dependsOn(jar)
    build.dependsOn(copy_plugin_jars) // TODO: make 'check' depend on it instead of 'build'?
}

// this doesn't seem to work :-/
//task listJars << {
//    configurations.compile.each { File file -> println file.name }
//}

apply plugin: 'base' // necessary to get the global 'clean' task

// remove DIST/**
task cleanDIST(type: Delete) {
    delete './DIST'
}
clean.dependsOn(cleanDIST)