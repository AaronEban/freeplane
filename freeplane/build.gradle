dependencies {
    compile project(':JOrtho_0.4_freeplane')

    compile 'commons-lang:commons-lang:2.6',
            'commons-io:commons-io:2.4',
            'commons-codec:commons-codec:1.7',
            'com.jgoodies:forms:1.2.1',
            'com.github.insubstantial:flamingo:7.2.1',
            'com.github.insubstantial:substance:7.2.1',
            'com.github.insubstantial:substance-flamingo:7.2.1',
            'com.github.insubstantial:substance-swingx:7.2.1',
            'com.github.insubstantial:trident:7.2.1'

    compile files('./lib/SimplyHTML.jar','./lib/idw-gpl.jar')
}

task viewerJar(type: Jar) {
    // use '= project.manifest' to avoid that an OSGi manifest is created!
    manifest = project.manifest {
        attributes("Manifest-Version": "1.0",
                   "Permissions": "all-permissions",
                   "Codebase": "*",
                   "Application-Library-Allowable-Codebase": "*",
                   "Application-Name": "Freeplane Viewer Applet")
    }

    baseName = 'freeplaneviewer'
    dependsOn classes
    from (sourceSets.main.output) {
        exclude('**/application/**')
        exclude('**/osgi/**')
        exclude('**/mindmapmode/**')
        exclude('**/filemode/**')
        exclude('**/ortho/**')
        exclude('**/core/resources/ui/**')
        exclude('translations/**')
    }
    from ('./viewer-resources') {
        exclude('**/appletMenu.mm')
    }
    includeEmptyDirs = false
}

task editorJar(type: Jar) {
    // use '= project.manifest' to avoid that an OSGi manifest is created!
    manifest = project.manifest {
        attributes("Manifest-Version": "1.0",
                   "Main-Class": "org.freeplane.main.application.FreeplaneMain")
    }
    baseName = 'freeplaneeditor'
    dependsOn classes
    from (sourceSets.main.output) {
				include("**/application/**")
				include("**/mindmapmode/**")
				include("**/ortho/**")
				include("**/filemode/**")
				include("**/core/resources/ui/**")
				include("translations/**")
				exclude("**/*.jar") // probably not necessary
    }
    from ('./resources') {
				exclude("**/preferences.mm")
				exclude("**/browsemodemenu.mm")
				exclude("**/mindmapmodemenu.mm")
				exclude("**/filemodemenu.mm")
				exclude("**/stylemodemenu.mm")
    }
    includeEmptyDirs = false
}

task osgiJar(type: Jar) {
    // use '= project.manifest' to avoid that an OSGi manifest is created!
    manifest = project.manifest {
        attributes("Manifest-Version": "1.0")
    }
    baseName = 'freeplaneosgi'
    dependsOn classes
    from (sourceSets.main.output) {
         include("**/osgi/**")         
    }
    includeEmptyDirs = false
}

// do NOT build 'freeplane.jar' => this is currently REQUIRED to
// build the other projects :-(
//jar.enabled = false

// This task calls out to ant to perform an xslt task since it is an easier
// dependency to satisfy than a seperate gradle plugin. We may wish to change
// this in the future
task build_ui_xml {
 ant.xslt(in   : file('resources/xml/mindmapmoderibbon.xml'),
          style: file('resources/xslt/ribbons2menu.xsl'),
          out  : new File('resources/xml', 'mindmapmodemenu.xml')
         )
}

projectid = 'org.freeplane.core'

task copy_core_jars(type: Copy) {
     from ('build/libs') {
          include("*.jar")
     }
     from ('lib') {
          include("*.jar")
     }
     into('../DIST/core/' + projectid + '/lib/')
}

task copy_core_manifest(type: Copy) {
     from ('META-INF') {
          include("*.MF")
     }
     into('../DIST/core/' + projectid + '/META-INF/')
}

build.dependsOn(copy_core_jars)
build.dependsOn(copy_core_manifest)

jar.dependsOn viewerJar
jar.dependsOn editorJar
jar.dependsOn osgiJar
